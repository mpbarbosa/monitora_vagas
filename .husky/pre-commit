#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Pre-commit hook for documentation link validation
# This prevents commits with broken documentation links

echo "üîç Validating documentation links..."

# Get list of staged markdown files
STAGED_MD_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep "\.md$" || true)

if [ -z "$STAGED_MD_FILES" ]; then
  echo "‚úÖ No markdown files to validate"
  exit 0
fi

echo "üìù Checking markdown files:"
echo "$STAGED_MD_FILES" | sed 's/^/  - /'

# Run link validator on staged files
node scripts/validate-docs-links.js $STAGED_MD_FILES

if [ $? -ne 0 ]; then
  echo ""
  echo "‚ùå Link validation failed!"
  echo "Please fix the broken links before committing."
  echo ""
  echo "To skip this check (not recommended):"
  echo "  git commit --no-verify"
  echo ""
  exit 1
fi

echo "‚úÖ All documentation links are valid!"
exit 0
