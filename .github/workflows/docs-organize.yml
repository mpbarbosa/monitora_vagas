name: Documentation Organization

on:
  push:
    paths:
      - 'docs/**'
      - '*.md'
  pull_request:
    paths:
      - 'docs/**'
      - '*.md'

jobs:
  lint-and-organize:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install remark tools
        run: |
          npm install -g remark-cli remark-lint remark-preset-lint-recommended remark-validate-links
      
      - name: Lint documentation
        run: |
          remark docs/ --use remark-preset-lint-recommended --frail
      
      - name: Validate internal links
        run: |
          remark docs/ --use remark-validate-links --frail
        continue-on-error: true
      
      - name: Check documentation structure
        run: |
          echo "Checking documentation structure..."
          
          # Verify required directories exist
          required_dirs=(
            "docs/api"
            "docs/architecture"
            "docs/features"
            "docs/guides"
            "docs/implementation"
            "docs/specifications"
            "docs/standards"
            "docs/testing"
            "docs/workflows"
          )
          
          for dir in "${required_dirs[@]}"; do
            if [ ! -d "$dir" ]; then
              echo "❌ Missing required directory: $dir"
              exit 1
            fi
          done
          
          echo "✅ All required directories present"
      
      - name: Generate documentation report
        if: always()
        run: |
          echo "# Documentation Health Report" > docs-report.md
          echo "" >> docs-report.md
          echo "## Structure" >> docs-report.md
          echo '```' >> docs-report.md
          tree -L 2 docs/ >> docs-report.md
          echo '```' >> docs-report.md
          echo "" >> docs-report.md
          echo "## Statistics" >> docs-report.md
          echo "- Total Markdown files: $(find docs/ -name '*.md' | wc -l)" >> docs-report.md
          echo "- Total directories: $(find docs/ -type d | wc -l)" >> docs-report.md
          echo "- Last updated: $(date)" >> docs-report.md
      
      - name: Upload report
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: documentation-report
          path: docs-report.md
